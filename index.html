<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Hanafuda Koi-Koi</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="app">
      <section class="score-panel">
        <div class="score-box">
          <span>CPU</span>
          <strong id="cpu-score">0</strong>
        </div>
        <div class="meta-box">
          <div id="game-counter">Game 1 / 12</div>
          <div id="dealer-label">Dealer: You</div>
          <div id="turn-label">Turn: You</div>
        </div>
        <div class="score-box">
          <span>You</span>
          <strong id="player-score">0</strong>
        </div>
      </section>

      <section class="opponent-zone">
        <div class="zone-header">
          <span>CPU Hand</span>
          <span id="cpu-hand-count">8 cards</span>
        </div>
        <div class="opponent-layout">
          <div id="cpu-hand" class="cpu-hand-strip"></div>
          <aside id="cpu-profile" class="cpu-profile">
            <img id="cpu-avatar" alt="CPU profile avatar" />
            <div id="cpu-profile-name" class="cpu-profile-name">The Monk</div>
            <div id="cpu-profile-style" class="cpu-profile-style">Balanced</div>
          </aside>
        </div>
      </section>

      <section id="field-zone" class="field-zone">
        <div class="zone-header">
          <span>Field</span>
          <span class="field-meta">
            <span id="field-helper" class="field-helper" hidden>Choose 1</span>
            <span id="deck-count">Deck: 24</span>
          </span>
        </div>
        <div class="field-layout">
          <div id="field" class="field-grid"></div>
          <aside id="draw-preview" class="draw-preview">
            <div class="draw-preview-label">Recent Deck Pull</div>
            <div class="draw-preview-card">
              <canvas id="draw-preview-canvas" width="138" height="170"></canvas>
            </div>
            <div id="draw-preview-text" class="draw-preview-text">Waiting for draw.</div>
          </aside>
        </div>
      </section>

      <section class="captured-zone">
        <div class="captured-col">
          <div class="zone-header compact">
            <span>CPU Captures</span>
            <span id="cpu-captured-count">0</span>
          </div>
          <div id="cpu-captured" class="captured-grid"></div>
          <div id="cpu-yaku" class="yaku-line">No set</div>
        </div>
        <div class="captured-col">
          <div class="zone-header compact">
            <span>Your Captures</span>
            <span id="player-captured-count">0</span>
          </div>
          <div id="player-captured" class="captured-grid"></div>
          <div id="player-yaku" class="yaku-line">No set</div>
        </div>
      </section>

      <section id="player-zone" class="player-zone">
        <div class="zone-header">
          <span>Your Hand</span>
          <span id="koi-state">Koi-Koi: not called</span>
        </div>
        <div id="hand-lock-note" class="hand-lock-note" hidden>Finish field choice above.</div>
        <div id="player-hand" class="hand player"></div>
      </section>

      <section id="context-zone" class="context-zone">
        <button id="context-left-btn" type="button" class="context-btn" data-action="pass" disabled>
          Pass
        </button>
        <button id="context-right-btn" type="button" class="context-btn" data-action="koi" disabled>
          Koi-Koi
        </button>
      </section>

      <section class="message-zone">
        <div class="zone-header compact">
          <span>Action Log</span>
          <span id="log-count">0</span>
        </div>
        <ol id="action-log" class="action-log">
          <li>SYS: Loading cards...</li>
        </ol>
      </section>

      <header class="top">
        <div>
          <h1>Hanafuda Koi-Koi</h1>
        </div>
        <button id="rules-toggle" class="ghost" type="button">Rules</button>
      </header>

      <section id="rules-panel" class="rules-panel" hidden>
        <div class="rules-pages">
          <article class="rules-copy">
            <h2>How To Play</h2>
            <p>Everything below is written for new players and matches this version's house rules.</p>

            <details class="rules-section" open>
              <summary>Objective</summary>
              <ul>
                <li>Win points by making card combinations called <strong>yaku</strong>.</li>
                <li>A full match is 12 rounds (January through December).</li>
                <li>The highest total score after 12 rounds wins.</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Cards and Matching</summary>
              <ul>
                <li>The deck has 48 cards: 12 months, 4 cards per month.</li>
                <li>You match cards by <strong>month</strong>.</li>
                <li>Type markers on cards: <strong>BRT</strong> = bright, <strong>SED</strong> = seed, <strong>SCR</strong> = scroll, <strong>PLN</strong> = plain.</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Setup (Each Round)</summary>
              <ul>
                <li>Each player gets 8 cards in hand.</li>
                <li>8 cards are placed face-up on the field.</li>
                <li>Remaining cards form the draw deck.</li>
                <li>Round month follows round number (Round 1 January ... Round 12 December).</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Turn Structure</summary>
              <ul>
                <li><strong>Phase 1:</strong> Play one card from hand and resolve month matches.</li>
                <li><strong>Phase 2:</strong> Draw one card from deck and resolve month matches.</li>
                <li>If no match is made, that card stays on the field.</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Capture Rules</summary>
              <ul>
                <li>If exactly 1 matching field card exists, capture both cards.</li>
                <li>If exactly 2 matching field cards exist, choose 1 field card to capture.</li>
                <li>If exactly 3 matching field cards exist, capture all 4 cards.</li>
                <li><strong>4-of-month sweep:</strong> if your played/drawn card is the 4th while other 3 are on field, capture all 4.</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Yaku, Pass, and Koi-Koi</summary>
              <ul>
                <li>When you form a <strong>new yaku</strong>, choose to <strong>Pass</strong> or call <strong>Koi-Koi</strong>.</li>
                <li><strong>Pass:</strong> round ends and scorer gets <code>yaku points x table multiplier</code>.</li>
                <li><strong>Koi-Koi:</strong> round continues and table multiplier increases by 1 (max 4x).</li>
                <li>Multiplier starts at 1x every round.</li>
                <li>Only the player who ends the round by passing scores that round.</li>
                <li>If deck/hands run out before pass, the <strong>last Koi-Koi caller</strong> scores at current multiplier.</li>
                <li>Point add-ons to an existing yaku do <strong>not</strong> create a new pass/Koi-Koi decision.</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Round-to-Round Start Rules</summary>
              <ul>
                <li>If winner scored at <strong>3x or 4x</strong>, winner starts next round.</li>
                <li>If winner scored at <strong>1x or 2x</strong>, loser starts next round.</li>
                <li>If a round has no scoring yaku, do not replay it; carry starter logic from the most recent scored round.</li>
                <li><strong>1x carryover bonus (next round only):</strong> after a 1x win, the loser starts and may pass first yaku at 2x, or call Koi-Koi to jump to 3x.</li>
                <li>If the previous 1x winner gets first yaku instead, they use normal options (pass at 1x or Koi-Koi to 2x).</li>
                <li><strong>Round 12 leader rule:</strong> if the leading player forms first yaku at 1x, they must Koi-Koi (except when special 2x pass privilege applies).</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Scoring (Yaku List)</summary>
              <ul>
                <li>Five Brights: 10</li>
                <li>Four Brights: 8 (or 7 with rain bright)</li>
                <li>Three Brights (no rain bright): 5</li>
                <li>Blossom Viewing (Cherry Bright + Sake Cup): 5</li>
                <li>Moon Viewing (Moon Bright + Sake Cup): 5</li>
                <li>Animal Trio set: 5</li>
                <li>Red Scroll set: 5</li>
                <li>Blue Scroll set: 5</li>
                <li>Red and Blue Scroll sets together: 10</li>
                <li>Seeds: 5 seeds = 3, then +1 per extra seed</li>
                <li>Scrolls: 5 scrolls = 1, then +1 per extra scroll</li>
                <li>Plains: 10 plains = 1, then +1 per extra plain</li>
                <li>Sake Cup counts as seed only (not plain).</li>
                <li>Round Month Sweep (all 4 cards of current round month): 5</li>
              </ul>
            </details>

            <details class="rules-section">
              <summary>Quick Start</summary>
              <ul>
                <li>Match by month.</li>
                <li>Resolve hand play, then resolve deck pull.</li>
                <li>Build yaku in your captured cards.</li>
                <li>On a new yaku, decide Pass (bank now) or Koi-Koi (raise stakes).</li>
                <li>Highest total after 12 rounds wins.</li>
              </ul>
            </details>
          </article>
        </div>
      </section>
    </main>

    <script src="game.js"></script>
  </body>
</html>
